<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë°°êµ¬ íŒ€ ì§œê¸° PRO</title>
<style>
body { margin:0; font-family: Arial, sans-serif; }
#main { display:flex; flex-wrap:wrap; padding:20px; gap:20px; justify-content:center; }
#left { display:flex; flex-direction:column; align-items:center; }

h1 { font-size:28px; margin-bottom:5px; }
h2 { font-size:16px; margin-bottom:10px; color:#555; }

#court {
  position:relative; width:360px; height:720px;
  background:#f5f5f5; border:4px solid #333; box-sizing:border-box;
}
#inner-line { position:absolute; top:10px; left:10px; width:calc(100%-20px); height:calc(100%-20px); border:2px solid #999; box-sizing:border-box; pointer-events:none; }
#net { position:absolute; top:50%; left:0; width:100%; height:4px; background:#000; transform:translateY(-50%); }
.attack-line { position:absolute; left:0; width:100%; height:2px; background: orange; }
.attack-line.top { top:calc(50% - 120px); }
.attack-line.bottom { top:calc(50% + 120px); }

.player {
  width:70px; height:30px; border-radius:6px; color:black;
  font-size:13px; display:flex; align-items:center; justify-content:center;
  position:absolute; cursor:grab; user-select:none; text-align:center;
  padding:2px; box-shadow:0 0 3px rgba(0,0,0,0.7);
}
.player.yongTeam { border:2px solid #e74c3c; }
.player.wonTeam { border:2px solid #3498db; }

#players { margin-top:15px; display:flex; flex-wrap:wrap; width:540px; justify-content:center; }
.player-card { width:80px; height:40px; border-radius:6px; margin:3px; display:flex; align-items:center; justify-content:center; cursor:grab; user-select:none; font-size:12px; text-align:center; padding:2px; color:black; }

#teams { margin-top:10px; display:flex; gap:20px; font-weight:bold; font-size:16px; }
#teams .yongTeam { color:#e74c3c; }
#teams .wonTeam { color:#3498db; }

button { margin-top:10px; padding:5px 10px; cursor:pointer; }

#record-panel { width:280px; border:2px solid #333; padding:10px; height:720px; overflow-y:auto; font-size:12px; }
#record-panel h3 { margin-top:0; font-size:14px; }
.record-entry { display:flex; gap:5px; margin-bottom:5px; align-items:center; flex-wrap:wrap; }
.record-entry input { width:60px; font-size:12px; }
.record-entry button { font-size:11px; padding:2px 4px; }

.tooltip {
  position:absolute;
  background: rgba(0,0,0,0.8);
  color: #fff; padding:4px 6px;
  border-radius:4px;
  font-size:12px;
  pointer-events:none;
  white-space: nowrap;
  z-index:1000;
  display:none;
}

#ranking { margin-top:10px; font-size:13px; }
#ranking div { margin-bottom:5px; }
</style>

<!-- html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<!-- ì¹´ì¹´ì˜¤í†¡ SDK -->
<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
<script>
Kakao.init('38d4cf994a686540d1cf65664e3fad5b'); // JavaScript Key
console.log(Kakao.isInitialized());
</script>

</head>
<body>

<div id="main">
  <div id="left">
    <h1>ë°°êµ¬ íŒ€ ì§œê¸°</h1>
    <h2>ë°°ì¹˜ë°©ë²•: ê¾¹ ëˆŒëŸ¬ì„œ ë“œë˜ê·¸í•˜ê¸°</h2>
    <div id="teams">
      <span class="yongTeam">Yong íŒ€</span>
      <span class="wonTeam">Won íŒ€</span>
    </div>
    <div id="court">
      <div id="inner-line"></div>
      <div id="net"></div>
      <div class="attack-line top"></div>
      <div class="attack-line bottom"></div>
    </div>
    <div id="players"></div>
    <div>
      <button id="saveBtn">ë°°ì¹˜ ì €ì¥</button>
      <button id="loadBtn">ë°°ì¹˜ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button id="resetBtn">ì½”íŠ¸ ì´ˆê¸°í™”</button>
      <button id="shareBtn">ì¹´ì¹´ì˜¤í†¡ ê³µìœ </button>
    </div>
  </div>

  <div id="record-panel">
    <h3>ì„ ìˆ˜ ê¸°ë¡ (ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í›„ ìˆ˜ì • ê°€ëŠ¥)</h3>
    <div id="password-entry">
      <input type="password" id="passInput" placeholder="ë¹„ë°€ë²ˆí˜¸">
      <button id="passBtn">í™•ì¸</button>
      <div id="passStatus" style="color:red; font-size:12px;"></div>
    </div>
    <div id="selected-player">ì„ íƒëœ ì„ ìˆ˜: ì—†ìŒ</div>
    <div id="records-list"></div>
    <div id="add-record" style="margin-top:10px;">
      <input type="text" id="record-date" placeholder="ì›”/ì¼ (MM/DD)">
      <input type="number" id="record-played" placeholder="ì°¸ì—¬ ì„¸íŠ¸">
      <input type="number" id="record-won" placeholder="ìŠ¹ë¦¬ ì„¸íŠ¸">
      <button id="add-record-btn">ì¶”ê°€</button>
    </div>
    <div id="ranking">
      <h4>ë­í‚¹</h4>
      <div id="totalSetsTop">ì´ ì„¸íŠ¸ìˆ˜ 1ìœ„: -</div>
      <div id="winSetsTop">ìŠ¹ë¦¬ ì„¸íŠ¸ 1ìœ„: -</div>
      <div id="winRateTop">ìŠ¹ë¥  1ìœ„: -</div>
    </div>
  </div>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
const court = document.getElementById('court');
const playersDiv = document.getElementById('players');
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const resetBtn = document.getElementById('resetBtn');
const shareBtn = document.getElementById('shareBtn');
const selectedPlayerDiv = document.getElementById('selected-player');
const recordsList = document.getElementById('records-list');
const recordDateInput = document.getElementById('record-date');
const recordPlayedInput = document.getElementById('record-played');
const recordWonInput = document.getElementById('record-won');
const addRecordBtn = document.getElementById('add-record-btn');

let draggedPlayer = null;
let selectedPlayer = null;
let canEdit = false;

const rankingTotal = document.getElementById('totalSetsTop');
const rankingWin = document.getElementById('winSetsTop');
const rankingRate = document.getElementById('winRateTop');

const playersData = [
  {name:"ê¹€ì€ì£¼", gender:"F"}, {name:"ì´ê°•í•˜", gender:"F"},
  {name:"í•˜ë™êµ", gender:"M"}, {name:"ê¹€ì¤€í˜¸", gender:"M"},
  {name:"ì‹ ì¢…ì—´", gender:"M"}, {name:"ì´ì§„ì‹", gender:"M"},
  {name:"ê¹€ë¯¼ì¤‘", gender:"M"}, {name:"ì–‘ì¹˜ëª¨", gender:"M"},
  {name:"ì •ì˜ˆí›ˆ", gender:"M"}, {name:"ì´ì†Œì€", gender:"F"},
  {name:"ê¹€ë¯¼ì„", gender:"M"}, {name:"ì‹ ìƒìœ¤", gender:"M"},
  {name:"ì´ì§„ì•„", gender:"F"}, {name:"ê¹€ì§„ì˜¥", gender:"F"},
  {name:"ì´ì›ìœ¤", gender:"M"}, {name:"ì˜¤ì •ë¯¼", gender:"M"},
  {name:"ì „í™ì¤€", gender:"M"}, {name:"ì´ìƒìš©", gender:"M"},
  {name:"ê°•í˜œì†¡", gender:"F"}, {name:"ì´í–¥ë¯¸", gender:"F"},
  {name:"ì •ì„ ë¯¸", gender:"F"}, {name:"ìµœì •ë¯¼", gender:"F"},
  {name:"ì´ì€í¬", gender:"F"}
];

let playerRecords = JSON.parse(localStorage.getItem('playerRecords')) || {};
playersData.forEach(p=>{ if(!playerRecords[p.name]) playerRecords[p.name]=[]; });

function createInitialPlayers(){
  playersDiv.innerHTML='';
  playersData.forEach(p=>{
    const card = document.createElement('div');
    card.classList.add('player-card');
    card.innerText=p.name;
    card.style.backgroundColor = p.gender==='M' ? 'orange' : '#7CFC00';
    card.draggable=true;

    card.addEventListener('dragstart', e=>{ draggedPlayer=e.target; });

    card.addEventListener('click', ()=>{
      selectedPlayer={name:p.name, gender:p.gender, isCard:true, element:card};
      selectedPlayerDiv.innerText=`ì„ íƒëœ ì„ ìˆ˜: ${p.name}`;
      renderRecords();
    });

    playersDiv.appendChild(card);
  });
}
createInitialPlayers();

court.addEventListener('dragover', e=>e.preventDefault());
court.addEventListener('drop', e=>{
  e.preventDefault();
  if(!draggedPlayer) return;
  const rect = court.getBoundingClientRect();
  const x = e.clientX - rect.left - 35;
  const y = e.clientY - rect.top - 15;
  const playerObj = playersData.find(p=>p.name===draggedPlayer.innerText);

  const newPlayer = document.createElement('div');
  newPlayer.classList.add('player');
  if(y<360) newPlayer.classList.add('yongTeam');
  else newPlayer.classList.add('wonTeam');

  newPlayer.style.left=`${x}px`;
  newPlayer.style.top=`${y}px`;
  newPlayer.innerText = draggedPlayer.innerText;
  newPlayer.style.backgroundColor = playerObj.gender==='M' ? 'orange' : '#7CFC00';
  newPlayer.style.color = 'black';

  newPlayer.addEventListener('click', ()=>{
    selectedPlayer={name:playerObj.name, gender:playerObj.gender, isCard:false, element:newPlayer};
    selectedPlayerDiv.innerText=`ì„ íƒëœ ì„ ìˆ˜: ${playerObj.name}`;
    renderRecords();
  });

  newPlayer.draggable=true;
  newPlayer.addEventListener('dragstart', e=>{ draggedPlayer=e.target; });
  court.appendChild(newPlayer);
  if(draggedPlayer.classList.contains('player-card')) draggedPlayer.remove();
  draggedPlayer=null;
});

const passInput = document.getElementById('passInput');
const passBtn = document.getElementById('passBtn');
const passStatus = document.getElementById('passStatus');
passBtn.addEventListener('click', ()=>{
  if(passInput.value==='4321'){ canEdit=true; passStatus.innerText='ìŠ¹ì¸ë¨'; }
  else{ canEdit=false; passStatus.innerText='ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼'; }
});

function renderRecords(){
  recordsList.innerHTML='';
  if(!selectedPlayer) return;
  const records = playerRecords[selectedPlayer.name];
  records.forEach((r,i)=>{
    const div = document.createElement('div');
    div.classList.add('record-entry');
    const lost = r.played - r.won;
    div.innerHTML=`${r.date} ì°¸ì—¬:${r.played} ìŠ¹:${r.won} íŒ¨:${lost} <button data-index="${i}">ì‚­ì œ</button>`;
    div.querySelector('button').addEventListener('click', ()=>{
      if(canEdit){
        records.splice(i,1);
        renderRecords();
        updateRanking();
        savePlayerRecords();
      } else alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
    });
    recordsList.appendChild(div);
  });
  updateRanking();
}

addRecordBtn.addEventListener('click', ()=>{
  if(!canEdit){ alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.'); return; }
  if(!selectedPlayer){ alert('ì„ ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
  const date = recordDateInput.value.trim();
  const played = parseInt(recordPlayedInput.value);
  const won = parseInt(recordWonInput.value);
  if(!date || isNaN(played) || isNaN(won) || won>played){ alert('ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤.'); return; }
  playerRecords[selectedPlayer.name].push({date,played,won});
  recordDateInput.value=''; recordPlayedInput.value=''; recordWonInput.value='';
  renderRecords();
  savePlayerRecords();
});

function updateRanking(){
  let maxPlayed=0,maxWon=0,maxRate=0;
  let playedNames=[],wonNames=[],rateNames=[];
  playersData.forEach(p=>{
    const recs=playerRecords[p.name];
    const totalPlayed=recs.reduce((a,b)=>a+b.played,0);
    const totalWon=recs.reduce((a,b)=>a+b.won,0);
    const rate = totalPlayed ? Math.round(totalWon/totalPlayed*100) : 0;
    if(totalPlayed>maxPlayed){ maxPlayed=totalPlayed; playedNames=[p.name]; }
    else if(totalPlayed===maxPlayed) playedNames.push(p.name);
    if(totalWon>maxWon){ maxWon=totalWon; wonNames=[p.name]; }
    else if(totalWon===maxWon) wonNames.push(p.name);
    if(rate>maxRate){ maxRate=rate; rateNames=[p.name]; }
    else if(rate===maxRate) rateNames.push(p.name);
  });
  rankingTotal.innerText=`ì´ ì„¸íŠ¸ìˆ˜ 1ìœ„: ${playedNames.join(', ')}`;
  rankingWin.innerText=`ìŠ¹ë¦¬ ì„¸íŠ¸ 1ìœ„: ${wonNames.join(', ')}`;
  rankingRate.innerText=`ìŠ¹ë¥  1ìœ„: ${rateNames.join(', ')}`;
}

function savePlayerRecords(){ localStorage.setItem('playerRecords', JSON.stringify(playerRecords)); }

saveBtn.addEventListener('click', ()=>{
  const players=court.querySelectorAll('.player');
  const data=Array.from(players).map(p=>{
    const playerObj = playersData.find(pl=>pl.name===p.innerText);
    return { name:p.innerText, gender:playerObj.gender, team:p.classList.contains('yongTeam')?'Yong':'Won', x:parseFloat(p.style.left), y:parseFloat(p.style.top) };
  });
  localStorage.setItem('volleyballLayout',JSON.stringify(data));
  alert('ë°°ì¹˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
});

loadBtn.addEventListener('click', ()=>{
  const savedData=localStorage.getItem('volleyballLayout');
  if(!savedData){ alert('ì €ì¥ëœ ë°°ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
  court.querySelectorAll('.player').forEach(p=>p.remove());
  const data=JSON.parse(savedData);
  data.forEach(d=>{
    const newPlayer=document.createElement('div');
    newPlayer.classList.add('player',d.team==='Yong'?'yongTeam':'wonTeam');
    newPlayer.style.left=`${d.x}px`;
    newPlayer.style.top=`${d.y}px`;
    newPlayer.innerText=d.name;
    newPlayer.style.backgroundColor = d.gender==='M' ? 'orange' : '#7CFC00';
    newPlayer.style.color='black';
    newPlayer.draggable=true;
    newPlayer.addEventListener('click', ()=>{ selectedPlayer={name:newPlayer.innerText, gender:d.gender, isCard:false, element:newPlayer}; selectedPlayerDiv.innerText=`ì„ íƒëœ ì„ ìˆ˜: ${newPlayer.innerText}`; renderRecords(); });
    newPlayer.addEventListener('dragstart', e=>{ draggedPlayer=e.target; });
    court.appendChild(newPlayer);
  });
});

resetBtn.addEventListener('click', ()=>{
  court.querySelectorAll('.player').forEach(p=>p.remove());
  createInitialPlayers();
});

// ğŸŸ¢ ì¹´ì¹´ì˜¤í†¡ ê³µìœ  (ì½”íŠ¸ ì´ë¯¸ì§€ í¬í•¨)
shareBtn.addEventListener('click', ()=>{
  html2canvas(court).then(canvas=>{
    const imageUrl = canvas.toDataURL('image/png');

    Kakao.Link.sendDefault({
      objectType: 'feed',
      content: {
        title: 'ì˜¤ëŠ˜ ë°°êµ¬íŒ€ ë°°ì¹˜',
        description: 'ì½”íŠ¸ ìœ„ ë°°ì¹˜ ìƒíƒœì…ë‹ˆë‹¤.',
        imageUrl: imageUrl,
        link: {
          mobileWebUrl: 'https://ycmphy1209-sudo.github.io',
          webUrl: 'https://ycmphy1209-sudo.github.io'
        }
      }
    });
  });
});
</script>

</body>
</html>
